<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>LeetCode 進度總覽</title>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    #chart-container {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
    }
    .loading {
      color: gray;
      font-style: italic;
    }
  </style>
</head>
<body>
  <h1>LeetCode Progress Chart</h1>
  <p>此圖表顯示多位使用者每天的累計解題數量。</p>
  <div id="chart-container">
    <canvas id="progressChart"></canvas>
    <p id="loadingText" class="loading">Loading chart data...</p>
  </div>

  <script>
    // 1. 先抓取 daily_progress.json
    fetch('./daily_progress.json')
      .then(response => response.json())
      .then(data => {
        // data 結構：
        // {
        //   "2025-03-21": { "kevin1010607": 123, "johnson684": 150, ... },
        //   "2025-03-22": { "kevin1010607": 128, "johnson684": 153, ... }
        // }

        // 2. 將 data 轉成 Chart.js 需要的格式
        //    先取得所有日期(排序後)與所有使用者ID
        const allDates = Object.keys(data).sort(); // ["2025-03-21", "2025-03-22", ...]
        const sampleDate = data[allDates[0]] || {};
        const allUsers = Object.keys(sampleDate);  // ["kevin1010607", "johnson684", ...]

        // 3. 為每個使用者準備一條 line
        //    datasets: [{ label: user1, data: [...], borderColor: ..., fill: false }, ...]
        const datasets = allUsers.map((user, idx) => {
          // 每個日期對應的解題數
          const userData = allDates.map(date => data[date][user]);
          
          // 簡單幫每條線做個顏色
          const colorList = ["#ff6384", "#36a2eb", "#cc65fe", "#ffce56", "#4bc0c0", "#9966ff", "#f67019"];
          const color = colorList[idx % colorList.length];

          return {
            label: user,
            data: userData,
            borderColor: color,
            backgroundColor: color,
            tension: 0.1,
            fill: false
          };
        });

        // 4. 建立 Chart.js
        const ctx = document.getElementById('progressChart').getContext('2d');
        const chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: allDates,
            datasets: datasets
          },
          options: {
            responsive: true,
            plugins: {
              title: {
                display: true,
                text: 'LeetCode Daily Progress'
              },
              legend: {
                display: true
              }
            },
            scales: {
              x: {
                title: {
                  display: true,
                  text: 'Date'
                }
              },
              y: {
                title: {
                  display: true,
                  text: 'Total Solved'
                },
                beginAtZero: true
              }
            }
          }
        });

        // 5. 移除「Loading...」字樣
        document.getElementById("loadingText").style.display = "none";
      })
      .catch(err => {
        document.getElementById("loadingText").textContent = "Error loading data: " + err;
      });
  </script>
</body>
</html>
